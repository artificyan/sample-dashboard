<html lang="en">
    <head>

        <title>Energy Drink Sales Dashboard</title>

        <!-- Required meta tags -->
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Load Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous" />

        <!-- Import Google font -->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:300" rel="stylesheet">

        <!-- Additional CSS styles -->
        <link rel='stylesheet' type='text/css' href='/../../../static/css/style.css'/>

        <!-- Chart.js -->
        <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js'></script>
    
    	<!-- Load jQuery -->
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	    <style>
	    	body {
    			font-family: 'Montserrat';
    			padding-left: 50px;
    			padding-top: 50px;
    			padding-bottom: 50px;
			}

			.btn-outline-primary {
				border-color: #FF7011;
				color: #415767;
				pointer-events: none;
			}

			h2 {
				font-weight: bold;
				color: #415767;
			}

			table, th, td {
    			border: 1px solid #DCDCDC;
			}

			th {
				font-size: 1.05em;
				background-color: #E9E9E9;
			}

			th, td { 
				padding: 5px; 
			}
	    </style>

    </head>

    <body>

	    <div id="search-parameters">
	    	<h2>Your Search Parameters</h2>
	    		<button type="button" class="btn btn-outline-primary">{{ brand }}</button>
	    		<button type="button" class="btn btn-outline-primary">{{ retailer }}</button>
	    		<button type="button" class="btn btn-outline-primary">{{ start_date }}</button>
	    		<button type="button" class="btn btn-outline-primary">{{ end_date }}</button>
		</div>

	    <br><br>

		<div id="household-counts">
	        <h2>Household Counts</h2>
	        	<p>{{ total_hhs }} households shopped between {{ min_date }} and {{ max_date }} (largest available date range).</p>

	        	<p>{{ count_hhs }} households purchased {{ brand }} products from {{ retailer }} between {{ start_date }} and {{ end_date}}.</p>
	    </div>

	    <br><br>

	    <div id="household-spending">
	        <h2>Average Household Spending by Brand</h2>
	        <h5>For the period {{ start_date }} through {{ end_date }}</h5>
	        <br>

	        <div id="household-spending-table">
		        <table style="width:50%">
				  <tr style="text-align: left">
				    <th>Brand</th>
				    <th>Avg. Spend / HH</th> 
				    <th>Total Spent</th>
				    <th>Households</th>
				  </tr>

			        {% for key, value in avg_brand_spend_hh.items %}

						<tr>
			        	{% for item in value %}
			        		{% if forloop.first %}
			        			<td>{{ key }}</td> 
			        			<td>${{ item }}</td>

			        		{% elif forloop.last %}
				        		<td>{{ item }}</td>

			        		{% else %}
				        		<td>${{ item }}</td>
				        	{% endif %}
			        	{% endfor %}
			        	</tr>
		        	{% endfor %}
				</table>
				<br>
				<br>
			</div> <!-- End household-spending-table -->
		</div> <!-- End household-spending -->

		<div id="household-spending-chart" class='col-lg-6'>
			<canvas id="hh-spend-chart"></canvas>
		</div>

		<br><br><br>

		<script>
	    {% block jquery %}

	    var endpoint = '/api/chart/data/';
	    var defaultData = [];
	    var labels = [];

	    	$.ajax({
	    		method: 'GET',
	    		url: endpoint,
	    		success: function(data) {
	    			labels = data.sorted_brands;
	    			data = data.sorted_avg_spend;
	    			console.log(data);

			    	var ctx = document.getElementById("hh-spend-chart").getContext('2d');
					var myChart = new Chart(ctx, {
					    type: 'bar',
					    data: {
					        labels: labels,
					        datasets: [{
					            label: 'Avg. $ Spent per Household',
					            data: data,
					            backgroundColor: [
								                '#FF7011',
								                '#FF7011',
								                '#FF7011',
								                '#FF7011',
								],
			    			}],
			    		},
			    	})
			    },
	    		error: function(error_data) {
	    			console.log("error");
	    			console.log(error_data);
	    		}
	    	})



			//             borderColor: [
			//                 'rgba(255,99,132,1)',
			//                 'rgba(54, 162, 235, 1)',
			//                 'rgba(255, 206, 86, 1)',
			//                 'rgba(75, 192, 192, 1)',
			//                 'rgba(153, 102, 255, 1)',
			//                 'rgba(255, 159, 64, 1)'
			//             ],
			//             borderWidth: 1
			//         }]
			//     },
			//     options: {
			//         scales: {
			//             yAxes: [{
			//                 ticks: {
			//                     beginAtZero:true
			//                 }
			//             }]
			//         }
			//     }
			// });
		{% endblock %}
	    </script>

		<!-- Load JS for Bootstrap-->
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>

		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    </body>
</html>